# 收藏功能测试指南

## 前提条件

1. 已在Supabase中创建user_favorites表（执行/workspace/user_favorites_table.sql）
2. 已在微信开发者工具中打开项目
3. 已登录测试账号
4. Supabase中有测试的community_events数据

---

## 测试步骤

### 测试1：社群页面收藏按钮

#### 步骤
1. 启动小程序，进入"社区"页面（底部TabBar第3个）
2. 观察每个活动卡片右下角是否有"收藏"按钮
3. 点击任意一个活动的"收藏"按钮

#### 预期结果
- 按钮文字从"收藏"变为"已收藏"
- 按钮背景从浅绿色变为渐变绿色
- 按钮文字从绿色变为白色
- 出现心跳动画效果
- 显示Toast提示"收藏成功"
- 顶部"收藏"Tab的数量徽章增加1

#### 失败排查
- 检查user_favorites表是否创建
- 查看控制台是否有API错误
- 确认Supabase URL和Key配置正确

---

### 测试2：取消收藏

#### 步骤
1. 在社区页面找到一个已收藏的活动（"已收藏"按钮）
2. 点击"已收藏"按钮

#### 预期结果
- 按钮文字从"已收藏"变回"收藏"
- 按钮背景从渐变绿色变回浅绿色
- 按钮文字从白色变回绿色
- 显示Toast提示"已取消收藏"
- 顶部"收藏"Tab的数量徽章减少1

---

### 测试3：收藏数量徽章（社群页）

#### 步骤
1. 在社区页面收藏3个不同的活动
2. 观察顶部"收藏"Tab

#### 预期结果
- "收藏"Tab右侧显示绿色徽章
- 徽章显示数字"3"
- 徽章样式：白色数字 + 渐变绿色背景 + 阴影

---

### 测试4：收藏视图切换

#### 步骤
1. 在社区页面点击顶部"收藏"Tab
2. 观察页面内容

#### 预期结果
- 页面标题从"社区动态"变为"我的收藏"
- 页面只显示已收藏的活动
- 如果没有收藏，显示空状态："没有收藏的活动，去看看你感兴趣的吧"
- 收藏的活动仍然显示"已收藏"按钮

#### 额外测试
1. 在收藏视图中取消一个收藏
2. 该活动应立即从列表中消失

---

### 测试5：首页通知徽章

#### 步骤
1. 返回"首页"（底部TabBar第1个）
2. 观察右上角通知按钮（铃铛图标）

#### 预期结果
- 通知按钮右上角显示红色徽章
- 徽章显示收藏总数（例如"3"）
- 徽章有脉冲动画效果
- 徽章样式：白色数字 + 红色渐变背景 + 白色边框

---

### 测试6：首页通知按钮跳转

#### 步骤
1. 在首页点击右上角通知按钮
2. 观察页面跳转

#### 预期结果
- 自动跳转到社区页面
- 自动切换到"收藏"Tab视图
- 显示所有已收藏的活动

---

### 测试7：数量同步

#### 步骤
1. 在社区页面收藏一个新活动
2. 返回首页
3. 观察首页通知徽章数字

#### 预期结果
- 首页徽章数字自动更新
- 数字与社区页"收藏"Tab徽章一致

---

### 测试8：刷新保持状态

#### 步骤
1. 收藏3个活动
2. 退出小程序
3. 重新进入小程序
4. 进入社区页面

#### 预期结果
- 之前收藏的活动仍显示"已收藏"状态
- 收藏数量徽章显示正确数字
- 首页通知徽章也显示正确数字

---

### 测试9：网络错误处理

#### 步骤
1. 断开网络连接
2. 尝试收藏一个活动

#### 预期结果
- 按钮立即变为"已收藏"（乐观更新）
- 2秒后显示Toast"收藏失败，请重试"
- 按钮自动回滚为"收藏"状态
- 收藏数量不变

---

### 测试10：视觉效果

#### 测试项
1. 收藏按钮的心跳动画
2. 徽章的脉冲动画
3. 按钮点击的缩放效果
4. 颜色渐变是否流畅

#### 预期结果
- 所有动画流畅无卡顿
- 颜色过渡自然
- 符合emerald主题色系

---

## 数据验证

### Supabase后台检查

1. 登录Supabase控制台
2. 进入Table Editor
3. 查看user_favorites表

#### 预期数据
```
| id (UUID) | user_id (UUID) | event_id (UUID) | event_data (JSONB) | created_at |
|-----------|----------------|-----------------|---------------------|------------|
| xxx-xxx   | user-id-1      | event-id-1      | {title, location...}| 2025-11-21 |
| xxx-xxx   | user-id-1      | event-id-2      | {title, location...}| 2025-11-21 |
```

---

## 常见问题排查

### 问题1：收藏按钮点击无反应

**可能原因：**
- user_favorites表未创建
- userService.js路径错误
- 用户未登录

**排查步骤：**
1. 检查Supabase表是否存在
2. 查看控制台错误日志
3. 确认用户登录状态

---

### 问题2：收藏数量不同步

**可能原因：**
- 页面未正确刷新
- API调用失败

**排查步骤：**
1. 退出小程序重新进入
2. 检查网络请求是否成功
3. 查看Supabase数据是否正确

---

### 问题3：徽章不显示

**可能原因：**
- favoriteCount为0
- 样式未加载

**排查步骤：**
1. 确认至少收藏1个活动
2. 检查WXSS文件是否正确加载
3. 查看页面data中的favoriteCount值

---

## 性能测试

### 测试场景1：大量收藏
1. 收藏20+个活动
2. 观察收藏Tab加载速度
3. 观察滚动流畅度

### 测试场景2：快速点击
1. 快速连续点击收藏按钮5次
2. 观察UI是否正常
3. 检查最终收藏状态

---

## 测试检查清单

- [ ] 收藏按钮显示正确
- [ ] 点击收藏正常切换状态
- [ ] 心跳动画流畅
- [ ] 收藏成功提示正常
- [ ] 取消收藏正常
- [ ] 社群页收藏徽章显示
- [ ] 首页通知徽章显示
- [ ] 收藏视图切换正常
- [ ] 收藏列表显示正确
- [ ] 首页通知跳转正常
- [ ] 刷新后状态保持
- [ ] 网络错误正确回滚
- [ ] 数据正确存储到Supabase
- [ ] 收藏数量实时同步

---

## 测试报告模板

**测试时间：** _______________

**测试环境：**
- 微信开发者工具版本：_______________
- 测试设备：_______________

**测试结果：**

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 收藏按钮 | [ ] 通过 [ ] 失败 |  |
| 取消收藏 | [ ] 通过 [ ] 失败 |  |
| 社群徽章 | [ ] 通过 [ ] 失败 |  |
| 首页徽章 | [ ] 通过 [ ] 失败 |  |
| 数量同步 | [ ] 通过 [ ] 失败 |  |
| 状态保持 | [ ] 通过 [ ] 失败 |  |
| 网络错误 | [ ] 通过 [ ] 失败 |  |

**发现的问题：**
1. _______________
2. _______________

**建议改进：**
1. _______________
2. _______________

---

**祝测试顺利！**
