<!--pages/profile/profile.wxml-->
<view class="profile-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="profile-header">
    <!-- èƒŒæ™¯è£…é¥° -->
    <view class="header-bg">
      <view class="bg-blob blob-1"></view>
      <view class="bg-blob blob-2"></view>
    </view>

    <!-- å¤´éƒ¨å†…å®¹ -->
    <view class="header-content">
      <view class="logout-btn" bindtap="handleLogout">
        <text class="logout-icon">ğŸšª</text>
      </view>

      <view class="user-info">
        <view class="avatar-container">
          <image 
            src="{{userProfile.avatar_url || user.avatar}}" 
            class="user-avatar"
            mode="aspectFill"
          />
          <view class="vip-badge">
            <text class="vip-icon">ğŸ†</text>
          </view>
          <!-- å¤´åƒç¼–è¾‘æŒ‰é’® -->
          <view class="avatar-edit-btn" bindtap="handleEditAvatar">
            <text class="camera-icon">ğŸ“·</text>
          </view>
        </view>

        <view class="user-details">
          <view class="username-row">
            <text class="user-name">{{userProfile.nickname || user.name}}</text>
            <!-- æ˜µç§°ç¼–è¾‘å›¾æ ‡ -->
            <view class="nickname-edit-icon" bindtap="handleEditNickname">
              <text class="edit-icon">âœï¸</text>
            </view>
          </view>
          <view class="vip-tag">
            <text>VIP è¿åŠ¨å®¶</text>
          </view>
        </view>
      </view>

      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <view class="stats-card">
        <view class="stat-item" bindtap="handleLoginDaysClick">
          <text class="stat-number">{{userStats.loginDays}}</text>
          <text class="stat-label">ç™»å½•å¤©æ•°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item" bindtap="handleSubscriptionsClick">
          <text class="stat-number">{{userStats.subscriptions}}</text>
          <text class="stat-label">è®¢é˜…ä¸»é¢˜</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item" bindtap="handleFavoriteClick">
          <text class="stat-number">{{userStats.favoriteCount}}</text>
          <text class="stat-label">æ´»åŠ¨æ”¶è—</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¥åº·è¯­å½•å¡ç‰‡ -->
  <view wx:if="{{healthQuote}}" class="health-quote-section">
    <view class="health-quote-card" bindtap="handleQuoteClick" bindlongpress="handleQuoteLongPress">
      <view class="quote-icon">ğŸ’¬</view>
      <view class="quote-content">
        <text class="quote-text">{{healthQuote.content}}</text>
        <text class="quote-author">â€” {{healthQuote.author || 'å¥åº·å°åŠ©æ‰‹'}}</text>
      </view>
      <view wx:if="{{showQuoteRefresh}}" class="refresh-btn" bindtap="handleRefreshQuote">
        <text class="refresh-icon">ğŸ”„</text>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®åŒºåŸŸ -->
  <view class="settings-section">
    <!-- å…¶ä»–è®¾ç½® -->
    <view class="settings-card">
      <view class="settings-menu">
        <view class="menu-item" bindtap="handleAbout">
          <view class="menu-icon">â„¹ï¸</view>
          <text class="menu-text">å…³äºåº”ç”¨</text>
          <text class="menu-arrow">â†’</text>
        </view>

        <view class="menu-item" bindtap="handleFeedback">
          <view class="menu-icon">ğŸ’¬</view>
          <text class="menu-text">æ„è§åé¦ˆ</text>
          <text class="menu-arrow">â†’</text>
        </view>

        <view class="menu-item" bindtap="handlePrivacy">
          <view class="menu-icon">ğŸ”’</view>
          <text class="menu-text">éšç§æ”¿ç­–</text>
          <text class="menu-arrow">â†’</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="version-info">
    <text>Rehaber Version 1.0.2</text>
  </view>

  <!-- æ˜µç§°ç¼–è¾‘å¼¹çª— -->
  <view wx:if="{{showNicknameModal}}" class="nickname-modal">
    <view class="modal-mask" bindtap="closeNicknameModal"></view>
    <view class="nickname-modal-content">
      <text class="nickname-modal-title">ä¿®æ”¹æ˜µç§°</text>
      <input 
        class="nickname-input" 
        type="text" 
        placeholder="è¯·è¾“å…¥æ–°æ˜µç§°" 
        value="{{newNickname}}"
        bindinput="onNicknameInput"
        maxlength="20"
      />
      <view class="nickname-modal-actions">
        <view class="nickname-modal-btn cancel" bindtap="closeNicknameModal">å–æ¶ˆ</view>
        <view class="nickname-modal-btn confirm" bindtap="saveNickname">ä¿å­˜</view>
      </view>
    </view>
  </view>
</view>